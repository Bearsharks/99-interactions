{"version":3,"sources":["Mosaic.module.css","PopUp.module.css","index.module.css","calLiWorker.js","greyScaleMaker.js","lib/MyCanvas.js","Mosaic.js","PopUp.js","index.js"],"names":["module","exports","code","onmessage","e","imgData","data","imgidx","pixels","lightness","i","length","parseInt","cnt","postMessage","toString","substring","indexOf","lastIndexOf","blob","Blob","type","worker_script","URL","createObjectURL","isFull","nOfSameLightnessImgs","Uint8ClampedArray","li","res","d","copy","ImageData","width","height","dataCopy","k","set","push","MyCanvas","options","default_args","index","this","vars","consts","simulate","render","init","_delete","delete","simulResult","_prevSResult","lastReq","canAnimRun","canRender","_canvas","_init","renderFrame","canvas","context","getContext","timestamp","requestAnimationFrame","bind","clearRect","_simulate","cancelAnimationFrame","param","console","assert","beginPath","moveTo","forEach","element","lineTo","closePath","style","fillStyle","fill","rgb","v","Math","max","c","min","h","round","hsv","f","n","array","image","sx","sy","sw","sh","dx","dy","dw","dh","abs","x1","x2","y1","y2","w_ratio","h_ratio","MosaicSize","canvasSize","MosaicInfo","bannedList","Set","imageIdx","Mosaic","React","memo","props","canvasRef","useRef","originCanvasRef","tmpCanvasRef","bgImgRef","bgImg","images","fetch","method","then","json","value","current","crossOrigin","src","thumbnailUrl","preventDefault","myc","setPos","pos","zoom","posX","posY","ratioX","ratioY","zoomScale","prevSize","originSize","maxZoomScale","viewportSize","preva","prevb","cura","curb","getClampVal","posToIdx","clientWidth","floor","click","x","curHoveredPos","y","originCanvas","numOfColPixel","numOfRowPixel","mosaicInfo","toCanvasCoeff","idxc","idxr","dc","dr","curMosaicSize","popUpSize","popUpPos","offsetLeft","offsetTop","imageInfo","popUp","imageId","name","thumbnail","webSearchUrl","emp","move","isInit","canMove","ratioW","ratioH","radioOfPic","renderedPixel","picPos","zeroX","zeroY","viewportSizeForPic","hoverLineSize","hoveredPos","slice","drawImage","getSafeRect","stroke","globalAlpha","renderLightness","pos_lightness","curImage","cur","imgs","imgs_lightness","candis","Array","has","rd","random","j","add","putImageData","map","imgInfo","base","renderLightnessCnt","strokeStyle","w","renderedW","renderedH","tmpctx","imageData","getImageData","curPixel","fillRect","onloadhandler","target","imgDatas","idx","window","Worker","calLiWorker","CalLiWorker","greyScaleMaker","GreyScaleMaker","isComplete","img2greyScale","lightnessMul","lightnessAdd","tmpimg","onload","Image","addEventListener","once","useEffect","isMoved","prev","downpos","onmove","touches","pageX","pageY","midx","midy","prevDiff","sqrt","changedTouches","identifier","diff","movementX","movementY","ondown","clientX","clientY","onup","splice","className","styles","dispNone","ref","onLoad","renderPicture","animStart","width100","onClick","onWheel","deltaY","onMouseMove","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchMove","onTouchEnd","PopUp","position","left","top","line","hide","Main","state","popUpInfo","setState","container","Component","App","path","component","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.69eed294.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"width100\":\"Mosaic_width100__2jt-x\",\"widthS\":\"Mosaic_widthS__3p1_J\",\"dispNone\":\"Mosaic_dispNone__3qLUa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"PopUp_block__3mkAn\",\"dispNone\":\"PopUp_dispNone__1foPo\",\"line\":\"PopUp_line__1o5o_\",\"width100\":\"PopUp_width100__3vPiY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"src_container__Xu5Sk\",\"linkActive\":\"src_linkActive__2Jb0z\"};","const workercode = () => {\r\n    onmessage = function(e) {\r\n        let imgData = e.data[0];\r\n        let imgidx = e.data[1];\r\n        let pixels = imgData.data;\r\n        let lightness = 0;\r\n        for (var i = 0; i < pixels.length; i += 4) {\r\n            lightness += parseInt((3*pixels[i] + 4*pixels[i + 1] + pixels[i + 2]) >>> 3);\r\n        }\r\n        let cnt = imgData.data.length/4;\r\n        lightness = parseInt(lightness / cnt);\r\n        postMessage([lightness, imgData,imgidx]);\r\n    }\r\n};\r\n\r\nlet code = workercode.toString();\r\ncode = code.substring(code.indexOf(\"{\")+1, code.lastIndexOf(\"}\"));\r\n\r\nconst blob = new Blob([code], {type: \"application/javascript\"});\r\nconst worker_script = URL.createObjectURL(blob);\r\n\r\nmodule.exports = worker_script;","const workercode = () => {\r\n    onmessage = function(e) {\r\n        let isFull = e.data.isFull;\r\n        let lightness = e.data.lightness;\r\n        let imgData = e.data.imgData;\r\n        let imgidx = e.data.imgidx;\r\n        let nOfSameLightnessImgs = e.data.nOfSameLightnessImgs;\r\n        let pixels = new Uint8ClampedArray(imgData.data);\r\n        for (let i = 0; i < pixels.length; i += 4) {\r\n            let li = parseInt((3*pixels[i] + 4*pixels[i + 1] + pixels[i + 2]) >>> 3);\r\n            pixels[i] = li;\r\n            pixels[i + 1] = li;\r\n            pixels[i + 2] = li;\r\n        }\r\n        let res = [];\r\n        for(let d = -20; d <= 10 ;d++){\r\n            if(lightness + d >= 5 && lightness + d <= 245 \r\n                && isFull[lightness + d] <= nOfSameLightnessImgs) {\r\n                let copy = new ImageData(imgData.width,imgData.height);\r\n                let dataCopy = new Uint8ClampedArray(pixels);\r\n                if(d < 0){\r\n                    let k = (lightness + d) / lightness;\r\n                    for (let i = 0; i < dataCopy.length; i += 4) {\r\n                        dataCopy[i] *= k;\r\n                        dataCopy[i + 1] *= k;\r\n                        dataCopy[i + 2] *= k;\r\n                    }\r\n                }else if (d > 0){\r\n                    for (let i = 0; i < dataCopy.length; i += 4) {\r\n                        dataCopy[i] += d;\r\n                        dataCopy[i + 1] += d;\r\n                        dataCopy[i + 2] += d;\r\n                    }\r\n                }\r\n                copy.data.set(dataCopy);\r\n                res.push([lightness+d,copy,imgidx]);\r\n            }\r\n        }\r\n        postMessage(res);\r\n    }\r\n};\r\n\r\nlet code = workercode.toString();\r\ncode = code.substring(code.indexOf(\"{\")+1, code.lastIndexOf(\"}\"));\r\n\r\nconst blob = new Blob([code], {type: \"application/javascript\"});\r\nconst worker_script = URL.createObjectURL(blob);\r\n\r\nmodule.exports = worker_script;","export class MyCanvas{\r\n  constructor(options){    \r\n    var default_args = {\r\n      'vars'       :   null,\r\n      'consts'     :   null,\r\n      'simulate'   :   ()=>{},\r\n      'render'     :   ()=>{},\r\n      'init'       :   ()=>{},\r\n      'delete'     :   ()=>{},\r\n    }\r\n    for (var index in default_args) {\r\n        if (typeof options[index] == \"undefined\") options[index] = default_args[index];\r\n    }\r\n    this.vars = options.vars;\r\n    this.consts = options.consts;\r\n    this.simulate = options.simulate;\r\n    this.render = options.render;\r\n    this.init = options.init;\r\n    this._delete = options.delete;\r\n    this.simulResult = null;\r\n    this._prevSResult = null;\r\n    this.lastReq = null;\r\n    this.canAnimRun = true;\r\n    this.canRender = true;\r\n  }\r\n  \r\n  animStart(_canvas){\r\n    this._init(_canvas);\r\n    this.renderFrame();\r\n  }\r\n  _init(_canvas){\r\n    this.canvas = _canvas;\r\n    this.context = _canvas.getContext('2d');\r\n    this.init();\r\n  }\r\n  renderFrame(timestamp){   \r\n    this.lastReq = requestAnimationFrame(this.renderFrame.bind(this));\r\n    if(!this.canAnimRun) return;    \r\n    this.context.clearRect(0, 0, this.canvas.width,  this.canvas.height);\r\n    this._simulate(timestamp);\r\n    if(!this.canRender) return;\r\n    this.render(timestamp);\r\n    \r\n  }\r\n  renderPicture(_canvas){\r\n    this._init(_canvas);\r\n    if(!this.canRender) return;\r\n    this.context.clearRect(0, 0, this.canvas.width,  this.canvas.height);\r\n    this.render();\r\n  }\r\n  _simulate(timestamp){\r\n    this.simulate(timestamp);\r\n  }\r\n  delete(){\r\n    cancelAnimationFrame(this.lastReq);\r\n    this._delete();\r\n  }\r\n  drawPolygon(param){\r\n    console.assert(param && param.length > 2, \"다각형을 구성하는 점이 너무 작습니다.\");\r\n    this.context.beginPath();\r\n    this.context.moveTo(param[0][0], param[0][1]);\r\n    param.forEach(element => {\r\n      this.context.lineTo(element[0],element[1]);\r\n    });\r\n    this.context.closePath();\r\n  }\r\n  fill(style){\r\n    this.context.fillStyle = style;\r\n    this.context.fill();\r\n  }\r\n  static rgb2hsv(rgb) {\r\n    let v = Math.max(rgb[0],rgb[1],rgb[2]), c = v-Math.min(rgb[0],rgb[1],rgb[2]);\r\n    let h = c && ((v===rgb[0]) ? (rgb[1]-rgb[2])/c : ((v===rgb[1]) ? 2+(rgb[2]-rgb[0])/c : 4+(rgb[0]-rgb[1])/c)); \r\n    return [Math.round(60*(h<0?h+6:h)), v&&c/v, v];\r\n  }\r\n  static hsv2rgb(hsv){                            \r\n    let f = (n,k=(n+hsv[0]/60)%6) => hsv[2] - hsv[2]*hsv[1]*Math.max( Math.min(k,4-k,1), 0);     \r\n    return [f(5),f(3),f(1)];       \r\n  }\r\n  static getGreyScale(imgData){\r\n    let array = imgData;\r\n    if(array.data) array = array.data;\r\n    return parseInt((3*array[0] + 4*array[1] + array[2]) >>> 3);\r\n  }\r\n  static lightnessMul(imgData,k){\r\n    let res = new ImageData(imgData.width,imgData.height);\r\n    var pixels = new Uint8ClampedArray(imgData.data);\r\n    for (var i = 0; i < pixels.length; i += 4) {\r\n      pixels[i] *= k;\r\n      pixels[i + 1] *= k;\r\n      pixels[i + 2] *= k;\r\n    }\r\n    res.data.set(pixels);\r\n    return res;\r\n  }\r\n  static lightnessAdd(imgData,k){\r\n    let res = new ImageData(imgData.width,imgData.height);\r\n    var pixels = new Uint8ClampedArray(imgData.data);\r\n    for (var i = 0; i < pixels.length; i += 4) {\r\n      pixels[i] += k;\r\n      pixels[i + 1] += k;\r\n      pixels[i + 2] += k;\r\n    }\r\n    res.data.set(pixels);\r\n    return res;\r\n  }\r\n  static img2greyScale(imgData){\r\n    let pixels = imgData.data;\r\n    for (var i = 0; i < pixels.length; i += 4) {\r\n        let lightness = parseInt((3*pixels[i] + 4*pixels[i + 1] + pixels[i + 2]) >>> 3);\r\n        pixels[i] = lightness;\r\n        pixels[i + 1] = lightness;\r\n        pixels[i + 2] = lightness;\r\n    }\r\n    return imgData;\r\n  }\r\n\r\n  static getSafeRect( image, sx, sy, sw, sh, dx, dy, dw, dh ) {  \r\n    const { width, height } = image;    \r\n    if( sw < 0 ) {\r\n      sx += sw;\r\n      sw = Math.abs( sw );\r\n    }\r\n    if( sh < 0 ) {\r\n      sy += sh;\r\n      sh = Math.abs( sh );\r\n    }\r\n    if( dw < 0 ) {\r\n      dx += dw;\r\n      dw = Math.abs( dw );\r\n    }\r\n    if( dh < 0 ) {\r\n      dy += dh;\r\n      dh = Math.abs( dh );\r\n    }\r\n    const x1 = Math.max( sx, 0 );\r\n    const x2 = Math.min( sx + sw, width );\r\n    const y1 = Math.max( sy, 0 );\r\n    const y2 = Math.min( sy + sh, height );\r\n    const w_ratio = dw / sw;\r\n    const h_ratio = dh / sh;\r\n\r\n    return [\r\n      image,\r\n      x1,\r\n      y1,\r\n      x2 - x1,\r\n      y2 - y1,\r\n      sx < 0 ? dx - (sx * w_ratio) : dx,\r\n      sy < 0 ? dy - (sy * h_ratio) : dy,\r\n      (x2 - x1) * w_ratio,\r\n      (y2 - y1) * h_ratio\r\n    ];\r\n  }\r\n}  ","import React, { useEffect,useRef, useState } from 'react';\r\nimport { MyCanvas } from './lib/MyCanvas';\r\nimport CalLiWorker from \"./calLiWorker\";\r\nimport GreyScaleMaker from \"./greyScaleMaker\";\r\nimport styles from './Mosaic.module.css';\r\n\r\n\r\nconst MosaicSize = 30;\r\nconst NumOfPixel = 80;\r\nconst canvasSize = 800;\r\nclass MosaicInfo{\r\n    constructor(){   \r\n        this.bannedList = new Set();\r\n        this.imageIdx = null;\r\n    }\r\n};\r\nconst Mosaic = React.memo((props)=> { \r\n    let canvasRef = useRef(null);\r\n    let originCanvasRef = useRef(null);\r\n    let tmpCanvasRef = useRef(null);\r\n    let bgImgRef = useRef(null);\r\n    let bgImg = {};\r\n    let images = [];\r\n    fetch(\"/99-interactions/data.json\", {\r\n          method: 'GET',\r\n        }).then(res => res.json())\r\n        .then(json =>{\r\n            images = json.value;\r\n            bgImgRef.current.crossOrigin = \"Anonymous\";\r\n            bgImgRef.current.src = images[0].thumbnailUrl;\r\n        });\r\n    const preventDefault = e => e.preventDefault();\r\n    let myc = new MyCanvas({\r\n        consts :{\r\n            setPos : (dx,dy)=>{\r\n                myc.vars.pos[0] += dx;\r\n                myc.vars.pos[1] += dy;\r\n                myc.vars.pos[2] += dx;\r\n                myc.vars.pos[3] += dy; \r\n            },\r\n            zoom : (posX,posY,d)=>{\r\n                let ratioX = posX/canvasSize;\r\n                let ratioY = posY/canvasSize;\r\n                d *= myc.vars.zoomScale; \r\n                let prevSize = myc.vars.originSize / myc.vars.zoomScale;  \r\n                myc.vars.zoomScale = Math.min(myc.vars.maxZoomScale,Math.max(1,myc.vars.zoomScale+d));      \r\n                let viewportSize = myc.vars.originSize / myc.vars.zoomScale;  \r\n\r\n                let preva = prevSize * ratioX;\r\n                let prevb = prevSize * ratioY; \r\n                let cura = viewportSize * ratioX;   \r\n                let curb = viewportSize * ratioY;\r\n                let [dx,dy]= myc.consts.getClampVal(cura - preva,curb - prevb);\r\n\r\n                myc.consts.setPos(dx,dy); \r\n            },\r\n            posToIdx : (posX,posY)=>{\r\n                let ratioX = posX/canvasRef.current.clientWidth;\r\n                let ratioY = posY/canvasRef.current.clientWidth;\r\n                let viewportSize = myc.vars.originSize / myc.vars.zoomScale;  \r\n                let dx = viewportSize * ratioX;   \r\n                let dy = viewportSize * ratioY;\r\n\r\n                let idxC = Math.floor( (-myc.vars.pos[0] + dx)/MosaicSize);\r\n                let idxR = Math.floor( (-myc.vars.pos[1] + dy)/MosaicSize);\r\n                return [idxC,idxR];\r\n            },\r\n            click : (posX,posY)=>{\r\n                let x = myc.vars.curHoveredPos[0];\r\n                let y = myc.vars.curHoveredPos[1];\r\n                if(0 <= x && x < originCanvas.vars.numOfColPixel && 0 <= y && y < originCanvas.vars.numOfRowPixel\r\n                    && originCanvas.vars.mosaicInfo[y][x].imageIdx !== null){\r\n                    //현재 마우스 포인터가 캔버스 기준으로\r\n                    //현재 인덱스는 캔버스 기준으로 바꾸면 좌상단이 몇몇인가?\r\n                    let viewportSize = myc.vars.originSize / myc.vars.zoomScale;  \r\n                    let toCanvasCoeff = canvasRef.current.clientWidth / viewportSize;\r\n                    let idxc = x*MosaicSize*toCanvasCoeff;\r\n                    let idxr = y*MosaicSize*toCanvasCoeff;\r\n                    let zeroc = myc.vars.pos[0] *toCanvasCoeff;\r\n                    let zeror = myc.vars.pos[1] *toCanvasCoeff;\r\n                    idxc += zeroc;\r\n                    idxr += zeror;\r\n\r\n                    //좌상단과 현재 마우스 포인터를 비교해서 모자이크에서 얼마만큼 갔고 얼마만큼 남았나 \r\n                    let dc = posX - idxc; \r\n                    let dr = posY - idxr;\r\n                    let curMosaicSize = MosaicSize*toCanvasCoeff;\r\n\r\n\r\n                    let popUpSize = Math.floor(canvasRef.current.clientWidth/2 - curMosaicSize);\r\n                    let popUpPos = [0,0];\r\n                    if(posX > canvasRef.current.clientWidth/2) popUpPos[0] = posX + (curMosaicSize - dc) - popUpSize;\r\n                    else popUpPos[0] = (posX - dc);\r\n                    if(posY > canvasRef.current.clientWidth/2) popUpPos[1] = posY + (curMosaicSize - dr) - popUpSize;\r\n                    else popUpPos[1] = (posY - dr);\r\n                    popUpPos[0] = Math.min(canvasRef.current.clientWidth - popUpSize, Math.max(0,popUpPos[0])) + canvasRef.current.offsetLeft;\r\n                    popUpPos[1] = Math.min(canvasRef.current.clientWidth - popUpSize, Math.max(0,popUpPos[1])) + canvasRef.current.offsetTop;\r\n                    let imageIdx = originCanvas.vars.mosaicInfo[y][x].imageIdx;\r\n                    let imageInfo = images[Math.floor(imageIdx)];\r\n                    props.popUp({\r\n                        popUpSize : popUpSize,\r\n                        popUpPos : popUpPos,\r\n                        imageId : imageInfo.imageId,\r\n                        name: imageInfo.name,\r\n                        thumbnail: imageInfo.thumbnail,\r\n                        thumbnailUrl: imageInfo.thumbnailUrl,\r\n                        webSearchUrl: imageInfo.webSearchUrl,\r\n                    });                  \r\n                }else{\r\n                    props.popUp(null);\r\n                }                \r\n            },            \r\n            emp: (posX,posY)=>{\r\n                let pos = myc.consts.posToIdx(posX,posY);\r\n                if(0 <= pos[0] && pos[0] < originCanvas.vars.numOfColPixel\r\n                    && 0 <= pos[1] && pos[1] < originCanvas.vars.numOfRowPixel){\r\n                        myc.vars.curHoveredPos = pos;\r\n                }else{\r\n                    myc.vars.curHoveredPos = [-100,-100];\r\n                }\r\n                \r\n            },\r\n            move : (dx,dy)=>{\r\n                if(!myc.vars.isInit || !myc.vars.canMove) return;\r\n                dx = dx*10/myc.vars.zoomScale;\r\n                dy = dy*10/myc.vars.zoomScale;\r\n                [dx,dy] = myc.consts.getClampVal(dx,dy);\r\n\r\n                myc.consts.setPos(dx,dy);\r\n            },\r\n            getClampVal:(x,y)=>{\r\n                let viewportSize = myc.vars.originSize / myc.vars.zoomScale;\r\n                //원본크기가 뷰포트사이즈보다 같거나 작을때\r\n                if(viewportSize >= myc.vars.originSize*myc.vars.ratioW){\r\n                    x = Math.max(-myc.vars.pos[0],x);//최소를 정함\r\n                    x = Math.min(viewportSize - myc.vars.pos[2],x);//최대를 정함\r\n                }else{\r\n                    x = Math.max(viewportSize - myc.vars.pos[2],x);//최소를 정함\r\n                    x = Math.min(-myc.vars.pos[0],x);//최대를 정함\r\n                }\r\n                if(viewportSize >= myc.vars.originSize*myc.vars.ratioH){\r\n                    y = Math.max(-myc.vars.pos[1],y);\r\n                    y = Math.min(viewportSize - myc.vars.pos[3],y);\r\n                }else{\r\n                    y = Math.max(viewportSize - myc.vars.pos[3],y);\r\n                    y = Math.min(-myc.vars.pos[1],y);\r\n                } \r\n                return [x,y];\r\n            }\r\n        },\r\n        vars : {\r\n            zoomScale : 1,\r\n            pos : [0,0,0,0],\r\n            curHoveredPos : [-10,-10],\r\n            isInit : false,\r\n            maxZoomScale : 1,\r\n            originSize : 1000,\r\n            canMove :false,\r\n            ratioW : 1,\r\n            ratioH : 1,\r\n            radioOfPic : 1,\r\n        },\r\n        init : ()=>{   \r\n            myc.vars.originSize = originCanvas.canvas.width > originCanvas.canvas.height ? originCanvas.canvas.width : originCanvas.canvas.height;\r\n            myc.vars.ratioW = originCanvas.canvas.width / myc.vars.originSize;\r\n            myc.vars.ratioH = originCanvas.canvas.height / myc.vars.originSize;\r\n            myc.vars.pos[0] = myc.vars.originSize* (1-myc.vars.ratioW)/2;\r\n            myc.vars.pos[1] = myc.vars.originSize* (1-myc.vars.ratioH)/2;\r\n            myc.vars.pos[2] = myc.vars.pos[0] + myc.vars.originSize*myc.vars.ratioW;\r\n            myc.vars.pos[3] = myc.vars.pos[1] + myc.vars.originSize*myc.vars.ratioH;\r\n            myc.vars.maxZoomScale = myc.vars.originSize*(100/MosaicSize)/canvasSize;\r\n            myc.vars.radioOfPic = bgImg.renderedPixel/myc.vars.originSize;\r\n            let d = myc.vars.pos[0]+myc.vars.pos[1];\r\n            if(d > canvasSize/8){\r\n                myc.consts.zoom(canvasSize/2,canvasSize/2,myc.vars.originSize/(myc.vars.originSize-1.7*d)-1);\r\n            }\r\n\r\n            myc.vars.isInit = true;\r\n\r\n        },\r\n        simulate : ()=>{\r\n            let viewportSize = myc.vars.originSize / myc.vars.zoomScale;\r\n            let picPos = [-bgImg.zeroX+myc.vars.pos[0]*myc.vars.radioOfPic, -bgImg.zeroY+myc.vars.pos[1]*myc.vars.radioOfPic];\r\n            let viewportSizeForPic = bgImg.renderedPixel /myc.vars.zoomScale;\r\n            let hoverLineSize = MosaicSize * canvasSize/viewportSize;\r\n            let hoveredPos = myc.vars.curHoveredPos.slice();\r\n            hoveredPos[0] = hoveredPos[0]*MosaicSize + myc.vars.pos[0];\r\n            hoveredPos[1] = hoveredPos[1]*MosaicSize + myc.vars.pos[1];\r\n            hoveredPos[0] *= canvasSize/viewportSize;\r\n            hoveredPos[1] *= canvasSize/viewportSize;\r\n            myc.simulResult = {\r\n                viewportSize : viewportSize,                \r\n                pos : myc.vars.pos,\r\n                picPos : picPos,\r\n                viewportSizeForPic : viewportSizeForPic,\r\n                hoveredPos : hoveredPos,\r\n                hoverLineSize : hoverLineSize,\r\n            };\r\n        },\r\n        render : ()=>{\r\n            //그리기\r\n            let res = myc.simulResult;\r\n            myc.context.drawImage(...MyCanvas.getSafeRect(originCanvas.canvas,\r\n                -res.pos[0], -res.pos[1], res.viewportSize, res.viewportSize,\r\n                0, 0, canvasSize, canvasSize));\r\n            myc.context.beginPath();\r\n            myc.context.lineTo(res.hoveredPos[0],res.hoveredPos[1]);\r\n            myc.context.lineTo(res.hoveredPos[0]+res.hoverLineSize,res.hoveredPos[1]);\r\n            myc.context.lineTo(res.hoveredPos[0]+res.hoverLineSize,res.hoveredPos[1]+res.hoverLineSize);\r\n            myc.context.lineTo(res.hoveredPos[0],res.hoveredPos[1]+res.hoverLineSize);\r\n            myc.context.closePath();\r\n            myc.context.stroke();\r\n\r\n            myc.context.globalAlpha = 0.2;\r\n            myc.context.drawImage(...MyCanvas.getSafeRect(bgImgRef.current,\r\n                -res.picPos[0], -res.picPos[1], res.viewportSizeForPic, res.viewportSizeForPic,\r\n                0,0,canvasSize,canvasSize));\r\n            myc.context.globalAlpha = 1;            \r\n        },\r\n    });\r\n    \r\n    let originCanvas = new MyCanvas({\r\n        consts :{\r\n            renderLightness : (lightness)=>{\r\n                for(let pos of originCanvas.vars.pos_lightness[lightness]) {\r\n                    let mosaicInfo = originCanvas.vars.mosaicInfo;\r\n                    let cur = mosaicInfo[pos[1]][pos[0]];\r\n                    let imgs = originCanvas.vars.imgs_lightness;\r\n                    let curImage; \r\n                    //이미지를 채울 때 주변에 이미 있는 사진은 제외함   \r\n                    let candis = new Array();                 \r\n                    for(let i in imgs[lightness]){\r\n                        let imgidx = imgs[lightness][i].imgidx;\r\n                        if(!cur.bannedList.has(imgidx)){\r\n                            candis.push([i,imgidx]);\r\n                        }\r\n                    }\r\n                    let rd = Math.floor(Math.random() * candis.length);\r\n                    if(!candis[rd]) debugger;\r\n                    cur.imageIdx = candis[rd][1];\r\n                    curImage = imgs[lightness][candis[rd][0]];\r\n                    //채울때 주변에 이 사진은 쓰지 말라고 표시함\r\n                    for(let i = -1; i <= 1; i++){\r\n                        for(let j = -1; j <= 1; j++){\r\n                            let x = pos[0]+i, y = pos[1]+j;\r\n                            if(mosaicInfo[y] && mosaicInfo[y][x]){\r\n                                mosaicInfo[y][x].bannedList.add(cur.imageIdx);\r\n                            }                            \r\n                        }                        \r\n                    }\r\n                    originCanvas.context.putImageData(curImage,pos[0]*MosaicSize,pos[1]*MosaicSize);  \r\n                }\r\n                originCanvas.vars.imgs_lightness[lightness] = null;\r\n                originCanvas.vars.pos_lightness[lightness] = null;\r\n            },\r\n            nOfSameLightnessImgs : 9,\r\n        },\r\n        vars : {\r\n            pos_lightness : new Array(256).fill(null).map(()=>new Array()),\r\n            imgs_lightness : new Array(256).fill(null).map(()=>new Array()),\r\n            imgInfo : [],\r\n            isFull : new Array(256).fill(false),\r\n            base : 0,\r\n            numOfColPixel : 0,\r\n            numOfRowPixel : 0,\r\n            mosaicInfo : null,\r\n            renderLightnessCnt : 0,\r\n        },\r\n        init : ()=>{            \r\n            //w, h 중 큰 것을 NumOfPixel개 로 나눠서 base를 구하고 base x base 크기의 정사각형으로 모자이크를 구성한다. \r\n            originCanvas.context.strokeStyle = 'rgba(0, 0, 0, 0)';\r\n            let w = bgImgRef.current.width;\r\n            let h = bgImgRef.current.height;\r\n            let base,numOfRowPixel,numOfColPixel;\r\n            if(w >= h){\r\n                base = w/NumOfPixel;\r\n                numOfRowPixel = parseInt(h/base);\r\n                h = numOfRowPixel * base;       \r\n                numOfColPixel = NumOfPixel;\r\n            }else{\r\n                base = h/NumOfPixel;\r\n                numOfColPixel = parseInt(w/base);\r\n                w = numOfColPixel * base;       \r\n                numOfRowPixel = NumOfPixel;\r\n            }\r\n\r\n            originCanvas.vars.mosaicInfo = new Array(numOfRowPixel);\r\n            for (var i = 0; i < numOfRowPixel; i++) {\r\n                originCanvas.vars.mosaicInfo[i] = new Array(numOfColPixel).fill(null).map(()=> new MosaicInfo());\r\n            }\r\n            //배경 이미지 로드 및 관련 정보 초기화\r\n            bgImg.renderedW = w;\r\n            bgImg.renderedH = h;\r\n            bgImg.zeroX = (bgImgRef.current.width - bgImg.renderedW)/2;\r\n            bgImg.zeroY = (bgImgRef.current.height - bgImg.renderedH)/2;\r\n            bgImg.renderedPixel = w > h ? w : h;\r\n            //drawImage를 활용 해상도를 기준 크기까지 줄임\r\n            tmpCanvasRef.current.width  = numOfColPixel;\r\n            tmpCanvasRef.current.height = numOfRowPixel;\r\n            let tmpctx = tmpCanvasRef.current.getContext('2d');\r\n            tmpctx.drawImage(bgImgRef.current,bgImg.zeroX,bgImg.zeroY,bgImg.renderedW,bgImg.renderedH,\r\n                                                    0,0,numOfColPixel,numOfRowPixel);\r\n\r\n            originCanvas.vars.base = base;\r\n            originCanvas.vars.numOfColPixel = numOfColPixel;\r\n            originCanvas.vars.numOfRowPixel = numOfRowPixel;\r\n            originCanvas.canvas.width = numOfColPixel*MosaicSize;\r\n            originCanvas.canvas.height = numOfRowPixel*MosaicSize;             \r\n        },\r\n        render : ()=>{                    \r\n            let vars = originCanvas.vars;\r\n            //돌면서 색상 채우고, 색상정보를 저장함\r\n            let tmpctx = tmpCanvasRef.current.getContext('2d');\r\n            let imageData = tmpctx.getImageData(0,0,vars.numOfColPixel,vars.numOfRowPixel).data;\r\n            for(let i = 0; i < vars.numOfRowPixel ; i++){\r\n                for(let j = 0; j < vars.numOfColPixel ; j++){\r\n                    let y = i*MosaicSize;\r\n                    let x = j*MosaicSize;\r\n                    let curPixel = 4*(i*vars.numOfColPixel + j);\r\n                    let lightness = parseInt((3*imageData[curPixel] + 4*imageData[curPixel+1] +imageData[curPixel+2]) >>> 3);\r\n                    lightness = Math.max(0,lightness-10);\r\n                    originCanvas.context.fillStyle = 'rgb('+ lightness + \",\"+ lightness +',' +lightness+')';\r\n                    originCanvas.context.fillRect(x,y,MosaicSize,MosaicSize);\r\n                    vars.pos_lightness[lightness].push([j,i]);\r\n                }                \r\n            }\r\n            //모자이크처리 이미지를 myc에 그리기 시작\r\n            myc.canAnimRun = true;\r\n            myc.canRender = true;\r\n            //사진을 하나씩 하나씩 불러오면서 비슷한 밝기에다 추가함\r\n            tmpCanvasRef.current.width  = MosaicSize * 2;\r\n            tmpCanvasRef.current.height = MosaicSize * 2;\r\n            \r\n            const onloadhandler = (e)=>{                        \r\n                tmpctx.drawImage(e.target, 0,0,MosaicSize*2,MosaicSize*2);\r\n                let imgDatas = [];\r\n                let idx = e.target.idx;\r\n                for(let i = 0; i < 4; i++){\r\n                    let x = (i%2 * MosaicSize);\r\n                    let y = Math.floor(i/2) * MosaicSize;\r\n                    imgDatas.push(tmpctx.getImageData(x,y,MosaicSize,MosaicSize));\r\n                }\r\n\r\n                if (!window.Worker) {\r\n                    for(let i = 0; i < 4; i++){\r\n                        let imageData = MyCanvas.img2greyScale(imgDatas[i]);\r\n                        let lightness = 0;\r\n                        let cnt = imageData.data.length/4;\r\n                        for(let i = 0 ; i < imageData.data.length; i+=4){\r\n                            lightness += imageData.data[i];\r\n                        }\r\n                        lightness = parseInt(lightness / cnt);\r\n                        \r\n                        for(let d = -20; d <= 10 ;d++){\r\n                            if(lightness + d >= 10 && lightness + d <= 235 && !originCanvas.vars.isFull[lightness + d]){\r\n                                if(d < 0){\r\n                                    let res = MyCanvas.lightnessMul(imageData, (lightness + d) / lightness);\r\n                                    res.imgidx = idx+i/10;\r\n                                    originCanvas.vars.imgs_lightness[lightness + d].push(res);\r\n                                }else if (d > 0){\r\n                                    let res = MyCanvas.lightnessAdd(imageData, d);\r\n                                    res.imgidx = idx+i/10;\r\n                                    originCanvas.vars.imgs_lightness[lightness + d].push(res);\r\n                                }else{\r\n                                    imageData.imgidx = idx+i/10;\r\n                                    originCanvas.vars.imgs_lightness[lightness + d].push(imageData);\r\n                                }\r\n\r\n                                let curSize = originCanvas.vars.imgs_lightness[lightness + d].length;\r\n                                if(curSize >= originCanvas.consts.nOfSameLightnessImgs){                                \r\n                                    originCanvas.vars.isFull[lightness + d] = true;\r\n                                    originCanvas.consts.renderLightness(lightness + d);\r\n                                }\r\n                            }                       \r\n                        } \r\n                    }                    \r\n                }else{\r\n                    const calLiWorker = new Worker(CalLiWorker);\r\n                    const greyScaleMaker = new Worker(GreyScaleMaker);  \r\n                    calLiWorker.onmessage = function(e) {//e에는  \r\n                        let lightness = e.data[0];\r\n                        let isComplete = true;\r\n                        for(let d = -20; d <= 10 ;d++){\r\n                            if(lightness + d >= 5 && lightness + d <= 245) {\r\n                                originCanvas.vars.isFull[lightness+d]++;\r\n                                if(originCanvas.vars.isFull[lightness+d] <= originCanvas.consts.nOfSameLightnessImgs){\r\n                                    isComplete = false;\r\n                                }\r\n                            }\r\n                        }\r\n                        if(!isComplete){\r\n                            greyScaleMaker.postMessage({\r\n                                isFull : originCanvas.vars.isFull,\r\n                                lightness : lightness,\r\n                                nOfSameLightnessImgs : originCanvas.consts.nOfSameLightnessImgs,\r\n                                imgData : e.data[1],\r\n                                imgidx : e.data[2]\r\n                            });\r\n                        }                        \r\n                    }\r\n                    greyScaleMaker.onmessage = function(e) {//e에는                        \r\n                        for(let i = 0; i< e.data.length;i++){\r\n                            let lightness = e.data[i][0];\r\n                            e.data[i][1].imgidx = e.data[i][2];\r\n                            originCanvas.vars.imgs_lightness[lightness].push(e.data[i][1]);\r\n                            let curSize = originCanvas.vars.imgs_lightness[lightness].length;\r\n                            if(curSize >= originCanvas.consts.nOfSameLightnessImgs){\r\n                                originCanvas.consts.renderLightness(lightness);\r\n                            }\r\n                        }                       \r\n                    }\r\n                    for(let i = 0; i < 4; i++){\r\n                        calLiWorker.postMessage([imgDatas[i],idx+i/10]);\r\n                    }                     \r\n                }\r\n                images[e.target.idx].tmpimg.onload = null;\r\n                images[e.target.idx].tmpimg = null;\r\n            };\r\n            \r\n            for(let idx = 0; idx < images.length/2;idx++){                \r\n                let tmpimg = new Image();\r\n                tmpimg.crossOrigin = \"Anonymous\";\r\n                tmpimg.idx = idx;                \r\n                tmpimg.addEventListener(\"load\", onloadhandler,{once : true});\r\n                tmpimg.src = images[idx].thumbnailUrl+\"&w=100&h=100&c=7\";\r\n                images[idx].tmpimg = tmpimg;\r\n            }\r\n            //정보 보여주는 팝업창을 띄우기\r\n        },\r\n    });\r\n    \r\n    useEffect(() => {\r\n        canvasRef.current.addEventListener('wheel', preventDefault);\r\n        return ()=>{\r\n            originCanvas.delete();\r\n            myc.delete();\r\n        }\r\n    }, []);\r\n\r\n    const onWheelhandler = (e)=>{\r\n        let x = e.pageX - canvasRef.current.offsetLeft;\r\n        let y = e.pageY - canvasRef.current.offsetTop;\r\n        if(e.deltaY > 0){\r\n            myc.consts.zoom(x,y,-0.1);\r\n        }else if(e.deltaY < 0){\r\n            myc.consts.zoom(x,y,0.1);\r\n        }\r\n    }\r\n\r\n    let isMoved = false;\r\n    let prev = [];\r\n    let downpos = [];\r\n    const onmove = (e)=>{\r\n        let x ,y;\r\n        if(e.touches){\r\n            if(prev.length >= 2){\r\n                let dx = prev[0].pageX - prev[1].pageX;\r\n                let dy = prev[0].pageY - prev[1].pageY;\r\n                let midx = (prev[0].pageX + prev[1].pageX)/2- canvasRef.current.offsetLeft;\r\n                let midy = (prev[0].pageY + prev[1].pageY)/2 - canvasRef.current.offsetTop;\r\n                let prevDiff = Math.sqrt(dx*dx + dy*dy);\r\n                for(let i = 0 ; i < e.changedTouches.length;i++){                    \r\n                    if(prev[0].identifier == e.changedTouches[i].identifier){\r\n                        prev[0] = e.changedTouches[i];\r\n                    }else{                        \r\n                        prev[1] = e.changedTouches[i];  \r\n                    }                    \r\n                }\r\n                dx = prev[0].pageX - prev[1].pageX;\r\n                dy = prev[0].pageY - prev[1].pageY;\r\n                let curDiff = Math.sqrt(dx*dx + dy*dy);\r\n                let diff = curDiff - prevDiff;\r\n                if(prevDiff){\r\n                    myc.consts.zoom(midx, midy, diff/(5*prevDiff))\r\n                }    \r\n                return;\r\n            }else{\r\n                x = e.touches[0].pageX;\r\n                y = e.touches[0].pageY;\r\n                e.movementX = x - prev[0].pageX\r\n                e.movementY = y - prev[0].pageY;\r\n                prev[0] = e.touches[0];\r\n            }            \r\n        }else{\r\n            x = e.pageX - canvasRef.current.offsetLeft;\r\n            y = e.pageY - canvasRef.current.offsetTop;\r\n        }\r\n        myc.consts.emp(x,y);\r\n        myc.consts.move(e.movementX, e.movementY);  \r\n    }\r\n    \r\n    const onClickhandler = (e)=>{\r\n        if(isMoved) return;\r\n        let x = e.pageX - canvasRef.current.offsetLeft;\r\n        let y = e.pageY - canvasRef.current.offsetTop;\r\n        myc.consts.click(x,y);\r\n    }\r\n    const ondown = (e)=>{\r\n        if(e.touches){\r\n            e.preventDefault();\r\n            if(prev.length > 2) return;\r\n\r\n            prev.push(e.touches[0]);\r\n        }else{\r\n            downpos = [e.clientX, e.clientY];\r\n        }        \r\n        myc.vars.canMove = true;\r\n    }\r\n    const onup = (e)=>{\r\n        if(e.touches){\r\n            for (var i = 0; i < prev.length; i++) {\r\n                if (prev[i].identifier == e.changedTouches[0].identifier) {\r\n                    prev.splice(i, 1);\r\n                    break;\r\n                }\r\n            }     \r\n        }else{\r\n            let d = e.clientX-downpos[0];\r\n            d += e.clientY-downpos[1];\r\n            isMoved = !!d;\r\n        }        \r\n        myc.vars.canMove = false;\r\n    }\r\n    const mouseLeave = (e)=>{      \r\n        myc.vars.canMove = false;\r\n    }\r\n    const onImageLoaded = (e)=>{          \r\n        myc.canRender = false;\r\n        myc.canAnimRun = false;\r\n        originCanvas.renderPicture(originCanvasRef.current);\r\n        myc.animStart(canvasRef.current);\r\n    }\r\n\r\n    return (\r\n        <>\r\n        <img className={styles.dispNone} ref={bgImgRef} onLoad={onImageLoaded}></img>\r\n        <canvas className={styles.width100} ref={canvasRef} width={canvasSize} height={canvasSize}\r\n            onClick={onClickhandler}\r\n            onWheel={onWheelhandler}\r\n            onMouseMove={onmove} \r\n            onMouseDown={ondown}\r\n            onMouseUp={onup}\r\n            onMouseLeave={mouseLeave}\r\n            onTouchStart={ondown}\r\n            onTouchMove={onmove}\r\n            onTouchEnd={onup}\r\n        >\r\n            이 브라우저는 캔버스를 지원하지 않습니다.\r\n        </canvas> \r\n        <canvas className={styles.dispNone} ref={tmpCanvasRef} width=\"100\" height=\"100\">\r\n        </canvas> \r\n        <canvas className={styles.dispNone} ref={originCanvasRef} width=\"100\" height=\"100\">\r\n        </canvas>                \r\n        </>  \r\n        \r\n    );\r\n});\r\n\r\nexport default Mosaic;","import React, { useEffect,useRef} from 'react';\r\nimport styles from './PopUp.module.css';\r\nfunction PopUp(props){\r\n    let abs;\r\n    if(props.imageInfo !== null){\r\n        abs = { \r\n            position: 'absolute',\r\n            left: `${props.imageInfo.popUpPos[0]}px`,\r\n            top: `${props.imageInfo.popUpPos[1]}px`,\r\n            width : `${props.imageInfo.popUpSize}px`,\r\n            height : `${props.imageInfo.popUpSize}px`,\r\n        };\r\n    }\r\n    /*{\r\n      popUpSize : popUpSize,\r\n      popUpPos : popUpPos,\r\n      imageId : imageInfo.imageId,\r\n      name: imageInfo.name,\r\n      thumbnail: imageInfo.thumbnail,\r\n      thumbnailUrl: imageInfo.thumbnailUrl,\r\n      webSearchUrl: imageInfo.webSearchUrl,                        \r\n    }*/\r\n    return (\r\n        <>\r\n        {props.imageInfo &&\r\n            <div className={styles.line} style={abs} onMouseLeave={props.hide}>            \r\n                <img className={styles.width100} src={props.imageInfo.thumbnailUrl+`&w=${props.imageInfo.popUpSize}&h=${props.imageInfo.popUpSize}&c=7`}/>            \r\n            </div>\r\n        }\r\n        </>\r\n    );\r\n}\r\n\r\nexport default PopUp;","import React, { Fragment } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter as Router ,Route, NavLink,Switch } from \"react-router-dom\";\r\nimport styles from './index.module.css';\r\nimport Mosaic from './Mosaic'\r\nimport PopUp from './PopUp'\r\n\r\nclass Main extends React.Component{\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {popUpInfo: null};\r\n    this.popUp = this.popUp.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n  popUp(popUpInfo){\r\n    if(popUpInfo === null){\r\n      this.hide();\r\n    }else{\r\n      this.setState({\r\n        popUpInfo: popUpInfo\r\n      });\r\n    }  \r\n  }\r\n\r\n  hide(){\r\n    this.setState({\r\n      popUpInfo: null\r\n    });\r\n  }\r\n\r\n  render(){\r\n    return (  \r\n      <>\r\n        \r\n        <div className={styles.container}>\r\n          \r\n          <main>\r\n            <Mosaic popUp = {this.popUp}/>     \r\n          </main>          \r\n          <PopUp imageInfo={this.state.popUpInfo}  hide={this.hide}></PopUp>\r\n        </div>\r\n         \r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nclass App extends React.Component {\r\n  render(){\r\n    return (  \r\n      <>\r\n        <Router>              \r\n          <Switch>\r\n            <Route path='/99-interactions' component={Main} />\r\n            <Route path='*'>\r\n              없음\r\n            </Route> \r\n          </Switch>      \r\n        </Router>  \r\n        <footer>\r\n            <p>contact : iginganza@gmail.com</p>\r\n        </footer> \r\n      </>      \r\n    );\r\n  } \r\n} \r\n\r\nReactDOM.render(<App/>, document.getElementById('root'));\r\n"],"sourceRoot":""}